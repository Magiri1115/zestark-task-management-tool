# テストチェック項目一覧
## AI構造強制型タスク管理システム

---

## 1. 単体テスト（Unit Test）

### 1-1. バリデーション

#### 1-1-1. タスク名バリデーション
- [ ] 有効なタスク名（1〜200文字）で成功すること
- [ ] 空文字でエラーになること（「タスク名は必須です」）
- [ ] 201文字以上でエラーになること（「タスク名は200文字以内です」）
- [ ] 1文字（境界値）で成功すること
- [ ] 200文字（境界値）で成功すること

#### 1-1-2. ステータスバリデーション
- [ ] `NOT_STARTED` で成功すること
- [ ] `IN_PROGRESS` で成功すること
- [ ] `COMPLETED` で成功すること
- [ ] 上記以外の値でエラーになること

#### 1-1-3. フェーズバリデーション
- [ ] 有効なフェーズ名（1〜100文字）で成功すること
- [ ] 空文字でエラーになること（「フェーズは必須です」）
- [ ] 101文字以上でエラーになること（「フェーズは100文字以内です」）

#### 1-1-4. 工数バリデーション
- [ ] 0.01（最小値）で成功すること
- [ ] 9999.99（最大値）で成功すること
- [ ] 0 でエラーになること（「工数は0.01以上」）
- [ ] 10000 でエラーになること（「工数は9999.99以下」）
- [ ] 負の値でエラーになること

#### 1-1-5. 工数レベルバリデーション
- [ ] `LIGHT` で成功すること
- [ ] `MEDIUM` で成功すること
- [ ] `HEAVY` で成功すること
- [ ] 上記以外の値でエラーになること

#### 1-1-6. 詳細説明バリデーション
- [ ] 空（任意項目）で成功すること
- [ ] 5000文字で成功すること
- [ ] 5001文字以上でエラーになること（「詳細説明は5000文字以内です」）

#### 1-1-7. ログインバリデーション
- [ ] 有効なメール形式で成功すること
- [ ] メール形式でない値でエラーになること
- [ ] パスワード6文字で成功すること
- [ ] パスワード5文字以下でエラーになること（「パスワードは6文字以上」）
- [ ] Email未入力でエラーになること
- [ ] Password未入力でエラーになること

---

### 1-2. ユーティリティ関数

#### 1-2-1. タスクコード生成（generateNextTaskCode）
- [ ] タスクが存在しない初回に `T1-01` が生成されること
- [ ] 同フェーズで `T1-01` → `T1-02` にインクリメントされること
- [ ] 同フェーズで `T1-09` → `T1-10` に2桁対応すること
- [ ] 新フェーズに変わったとき `T2-01` から開始されること
- [ ] フェーズ文字列から番号が正しく抽出されること（「第3段階」→ `T3-01`）

#### 1-2-2. ロック期限チェック（isLockExpired）
- [ ] ロック取得から14分以内のとき `false` を返すこと
- [ ] ロック取得から16分経過したとき `true` を返すこと
- [ ] ちょうど15分のとき `false` を返すこと（境界値）
- [ ] `locked_at` が `null` のとき `false` を返すこと

---

### 1-3. 権限チェック（checkPermission）

#### 1-3-1. admin ロール
- [ ] `create` 操作が許可されること
- [ ] `read` 操作が許可されること
- [ ] `update` 操作が許可されること
- [ ] `delete` 操作が許可されること
- [ ] `unlock` 操作が許可されること

#### 1-3-2. editor ロール
- [ ] `create` 操作が許可されること
- [ ] `read` 操作が許可されること
- [ ] `update` 操作が許可されること
- [ ] `delete` 操作が拒否されること（FORBIDDEN エラー）
- [ ] `unlock` 操作が拒否されること（FORBIDDEN エラー）

#### 1-3-3. viewer ロール
- [ ] `read` 操作のみ許可されること
- [ ] `create` 操作が拒否されること（FORBIDDEN エラー）
- [ ] `update` 操作が拒否されること（FORBIDDEN エラー）
- [ ] `delete` 操作が拒否されること（FORBIDDEN エラー）
- [ ] `unlock` 操作が拒否されること（FORBIDDEN エラー）

---

### 1-4. エラーハンドリング

#### 1-4-1. エラークラス定義
- [ ] `UnauthorizedError` が `code: 'UNAUTHORIZED'`、`statusCode: 401` で生成されること
- [ ] `ForbiddenError` が `code: 'FORBIDDEN'`、`statusCode: 403` で生成されること
- [ ] `NotFoundError` が `code: 'NOT_FOUND'`、`statusCode: 404` で生成されること
- [ ] `ValidationError` が `code: 'VALIDATION_ERROR'`、`statusCode: 400` で生成されること
- [ ] `LockError` が `code: 'CONFLICT'`、`statusCode: 409` で生成されること

#### 1-4-2. Prismaエラーハンドリング
- [ ] `P2002`（Unique制約違反）が `ConflictError` に変換されること
- [ ] `P2025`（レコード未発見）が `NotFoundError` に変換されること
- [ ] `PrismaClientInitializationError` が `DatabaseError` に変換されること

#### 1-4-3. エラーメッセージマッピング
- [ ] `UNAUTHORIZED` → `'ログインが必要です'` に変換されること
- [ ] `FORBIDDEN` → `'権限がありません'` に変換されること
- [ ] `NOT_FOUND` → `'データが見つかりません'` に変換されること
- [ ] `LOCK_NOT_HELD` → `'ロックを保持していません'` に変換されること
- [ ] 未定義コードが `'予期しないエラーが発生しました'` にフォールバックされること
