# 📘 タスク管理システム 要件定義書（清書版）

---

## 1. システム概要

### 1.1 システム名称
**AI構造強制型タスク管理システム**

### 1.2 目的
- **個人用タスク管理ツール**: AIが生成した構造化タスクを管理し、工数・進捗を可視化することで実行効率を最大化する。
- **公開閲覧可能**: 広告・宣伝用途として、第三者が進捗を閲覧できる。
- **将来的なSaaS化を視野に入れる**: 拡張性を持たせた設計とする。

### 1.3 利用形態
- **編集**: 管理者のみ（1ユーザー）
- **閲覧**: 全ユーザー可能
- **チーム利用**: なし

### 1.4 設計思想
- IDは不変（永続識別子）
- 構造を強制し、自由度を制限
- 数値データはDB正規化
- 自動算出可能なものはすべて自動化
- UI体験を重視

---

## 2. システム構成

| 項目 | 技術 |
|------|------|
| フロントエンド | Next.js（App Router） |
| バックエンド | Next.js Server Actions |
| データベース | PostgreSQL |
| デプロイ | Vercel |
| 認証 | URLパラメータ型トークン認証 |
| 定期実行 | Vercel Cron |

---

## 3. 機能要件

### 3.1 プロジェクト管理
- 1ユーザーが複数プロジェクトを保持可能（`projects` テーブルを維持）
- **公開/非公開フラグ**: 各プロジェクトに保持。
- **アクセス制御**: 非公開プロジェクトは管理者のみ閲覧可能。URL直打ちでも非公開は閲覧不可。

### 3.2 タスク管理
- **上限**: 最大1000タスク。
- **表示形式**: テーブル表示 / カード表示（切替可能）。
- **検索**: 実装しない。
- **分類（フェーズ）**: 分類列として保持。マスタ化はせず、集計グラフも作成しない。

#### 3.2.1 タスク項目定義
| 項目名 | 型 | 必須 | 備考 |
|--------|----|------|------|
| id | UUID | ○ | 主キー・不変 |
| task_code | VARCHAR | ○ | 表示用コード（例: T1-01） |
| name | VARCHAR | ○ | タスク名 |
| status | ENUM | ○ | 未着手 / 進行中 / 完了 |
| phase | VARCHAR | ○ | 分類（第1段階など） |
| effort_hours | NUMERIC | ○ | 数値型（単位:h） |
| effort_level | ENUM | ○ | 軽 / 中 / 重 |
| description | TEXT | 任意 | 詳細説明 |
| updated_at | TIMESTAMP | ○ | 更新日時 |
| deleted_at | TIMESTAMP | 任意 | 論理削除用 |

### 3.3 認証仕様
- **方式**: URLパラメータ型。
- **トークン**: 1ユーザー1固定トークン（有効期限なし）。環境変数で管理。
- **例**: `https://yourapp.vercel.app/?token=xxxxx`
- **動作**: トークン一致で「管理者モード（編集可）」、不一致で「閲覧モード（閲覧のみ）」。

### 3.4 削除仕様
- **論理削除**: `deleted_at` カラムを使用し、一旦ゴミ箱へ移動。
- **自動物理削除**: 削除から30日後に物理削除。Vercel Cronで定期実行。

### 3.5 バルクインポート
- **形式**: JSON
- **スキーマ例**:
  ```json
  [
    {
      "ID": "T1-01",
      "タスク名": "CSS内容分析",
      "ステータス": "未着手",
      "分類": "第1段階: UI",
      "工数レベル": "Low",
      "更新日": "2026-02-14",
      "説明": "既存CSSの確認",
      "工数": "0.5h"
    }
  ]
  ```
- **処理仕様**: 失敗時はロールバック。最大3回リトライし、失敗でエラー出力。トランザクション必須。

### 3.6 バックアップ
- **方式**: DB丸ごとダンプ。
- **提供**: 管理画面からダウンロード可能。
- **定期実行**: 週次バックアップ。Vercel Cronを利用。

---

## 4. SEOポリシー
- **方針**: トップページはインデックス許可（宣伝用）、プロジェクト詳細ページは拒否。
- **実装**: 
  - 詳細ページに `<meta name="robots" content="noindex, nofollow">` を配置。
  - `robots.txt` では全体拒否を行わない。

---

## 5. 非機能要件

### 5.1 パフォーマンス
- 1000タスク表示を 5秒以内 に完了する。

### 5.2 可用性
- ダウンタイム 5%以内。

### 5.3 セキュリティ
- CSRF対策 / XSS対策。
- Rate Limit実装。

### 5.4 エラーハンドリング
- エラーログをTXT形式で生成。
- クライアントからダウンロード可能。
- 保存期間：30日（個人情報は含まない）。

### 5.5 排他制御
- 個人利用のため、編集ロック機能は実装しない。

---

## 6. その他（未実装・将来拡張）
- 監査ログ：未実装
- 通知機能：未実装
- チーム利用：なし（1ユーザー想定）
