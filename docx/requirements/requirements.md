# 📘 タスク管理システム 要件定義書（清書版）

---

## 1. システム概要

### 1.1 システム名称
**AI構造強制型タスク管理システム**

### 1.2 目的
AIが生成した構造化タスクを管理し、  
工数・進捗を可視化することで実行効率を最大化する。

### 1.3 設計思想

- IDは不変（永続識別子）
- 構造を強制し、自由度を制限
- 数値データはDB正規化
- 自動算出可能なものはすべて自動化
- UI体験を重視
- 将来的なSaaS化・AI連携を視野に入れる

---

## 2. システム構成

| 項目 | 技術 |
|------|------|
| フロントエンド | Next.js（App Router） |
| バックエンド | Next.js Server Actions |
| データベース | PostgreSQL |
| デプロイ | Vercel |
| キャッシュ | Vercel Cache |
| グラフ描画 | Recharts |
| アクセス解析 | 外部スクリプト埋め込み |

---

## 3. 機能要件

---

## 3.1 タスク管理機能

### 3.1.1 タスク項目定義

| 項目名 | 型 | 必須 | 備考 |
|--------|----|------|------|
| id | UUID | ○ | 主キー・不変 |
| task_code | VARCHAR | ○ | 表示用コード（例: T1-01） |
| name | VARCHAR | ○ | タスク名 |
| status | ENUM | ○ | 未着手 / 進行中 / 完了 |
| phase | VARCHAR | ○ | 分類（第1段階など） |
| effort_hours | NUMERIC | ○ | 数値型（単位:h） |
| effort_level | ENUM | ○ | 軽 / 中 / 重 |
| description | TEXT | 任意 | 詳細説明 |
| locked_by | UUID | 任意 | 排他制御用 |
| locked_at | TIMESTAMP | 任意 | 排他制御用 |
| updated_at | TIMESTAMP | ○ | 更新日時 |

---

### 3.1.2 IDポリシー

- `id` は UUID
- 永続不変
- フェーズ変更によって変更しない
- `task_code` は表示上の分類コード

---

## 3.2 自動算出機能

以下はDBまたはフロント側で自動算出する。

### 3.2.1 タスク数
COUNT(id)

### 3.2.2 総工数
SUM(effort_hours)

### 3.2.3 完了率
完了タスク数 / 総タスク数 × 100

---

## 3.3 グラフ機能

### 使用ライブラリ
Recharts

### 表示内容
- 完了率（円グラフ）

### 仕様

- リアルタイム更新
- 数値とパーセンテージ表示
- モバイル非対応（PC限定想定）

---

## 3.4 編集機能

### 編集方法

1. タスク行をダブルクリック  
2. モーダル表示  
3. モーダル内でインライン編集  

### UI要件

- 編集中ロック表示
- 保存ボタン常時表示
- Escキーでキャンセル
- 他ユーザー編集時は編集不可

---

## 3.5 排他制御（悲観的ロック）

### 仕様

- 編集開始時に `locked_by`, `locked_at` を更新
- 他ユーザーは編集不可
- 一定時間経過で自動解除（時間は詳細設計で決定）
- DBトランザクション使用

---

## 3.6 ロール管理

### roles テーブル

| id | name |
|----|------|
| 1 | admin |
| 2 | editor |
| 3 | viewer |

### users テーブル

| id | name | role_id |

---

## 3.7 Excel出力機能

### 出力列（固定）
ID
タスク名
工数


### 備考

- フォーマット固定
- 詳細仕様は実装設計時に決定
- 金額・単価は将来拡張

---

## 4. キャッシュ戦略

### 使用技術
Vercel Cache

### 方針

- 読み込み：キャッシュ活用
- 書き込み：DB直書き
- 更新時の再検証方法は詳細設計で決定

### 留意点

- 排他制御があるため強キャッシュは避ける
- データ整合性を最優先

---

## 5. 非機能要件

### 5.1 パフォーマンス

- 同時接続 100人想定
- レスポンス 1 秒以内

### 5.2 可用性

- Vercel標準SLA準拠

### 5.3 拡張性

- SaaS化可能構造
- AI連携API拡張余地確保

---

## 6. ER構成（論理構造）
```
projects
└── tasks
└── locked_by → users

users
└── roles
```

---

## 7. 今後の詳細設計で決定する項目

- ロック自動解除時間
- 更新時キャッシュ再検証方式
- Excel生成方式
- 金額計算ロジック（将来）
- API認証方式